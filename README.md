# map_swap_example
[Django](https://djangoproject.com), [Leaflet.js](https://leafletjs.com/) and [HTMX](https://htmx.org) work together to seamlessly upload georeferenced data.
## Requirements
This project is tested on Django 5.0.3 and Python 3.12.0. It does NOT rely on `GeoDjango` framework, but on [django-leaflet](https://django-leaflet.readthedocs.io/en/latest/index.html/) as map engine, [django-geojson](https://django-geojson.readthedocs.io/en/latest/) for storing geodata and [django-htmx](https://django-htmx.readthedocs.io/en/latest/) to manage interactions. I use [Bootstrap 5](https://getbootstrap.com/) for styling. `django-leaflet` requires the `GDAL` library to work, which is system specific.
## Installation
Prepare a virtual environment, clone this repository (`git clone https://github.com/andywar65/map_swap_example`) then install packages (`python -m pip install -r requirements.txt`). Prepare a `.env` file with at least `SECRET_KEY` environment variable, add `DATABASE_URL` if you are forced to use a specific database. Migrate database tables (`python manage.py migrate`), run `python manage.py generate_locations` to seed database and then run the server (`python manage.py runserver`).
## Usage
If all went well, you should see a diakog box in the left/top section of the screen (depends on device) and a world map with the locations previously generated. Click on a marker, the location name will pop up. Click on the link and the map will focus on the surroundings of chosen location. if you want to go back to world map, there is a link in the dialog box. Swapping the maps requires the transfert of minimal `HTML` fragments, without reloading the whole page.
## How it works
The project has only one model: `Location`. The model has two text fields, `title` and `description`, and a `PointField` that stores geographic coordinates in `JSON` format. The only significant method of the model is `popupContent(location)` that returns an `HTML` string that pops up when the location marker is clicked on the map. The string looks something like this: `<a onclick="openLocation({ location.url })">{ location.title }</a>`, and it will be used to swap content from within the map.
The project has only two views, a `ListView` for displaying all locations and a `DetailView` to display just one. They are pretty standard `CBV`s, but they change behaviour depending on the request being triggered by `HTMX` or not. In the first case the templates will be partial, and some response headers will be dispatched.
